FROM python:3.12-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1

WORKDIR /app

# Layer 1 – deps (only changes when requirements.prod.txt changes)
COPY requirements.prod.txt .
RUN pip install -r requirements.prod.txt

# Layer 2 – source (changes frequently)
COPY src/  ./src/
COPY data/ ./data/

EXPOSE 8010 8011 8501

CMD ["python", "-m", "src.main"]